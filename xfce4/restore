#!/bin/sh

channels="displays keyboard-layout keyboards pointers ristretto thunar thunar-volman \
xfce4-appfinder xfce4-desktop xfce4-keyboard-shortcuts xfce4-notifyd xfce4-panel \
xfce4-power-manager xfce4-screensaver xfce4-session xfce4-settings-editor \
xfce4-settings-manager xfce4-taskmanager xfce4-terminal xfwm4 xsettings"

for channel in $channels; do
    config_file="$channel.txt"
    if [ -f "$config_file" ]; then
        echo "Applying settings from $config_file to channel $channel"
        while IFS= read -r line; do
            # Skip empty lines and comments
            [ -z "$line" ] && continue
            echo "$line" | grep -qE '^\s*#' && continue

            # Extract property and value (value may contain spaces)
            prop=$(echo "$line" | awk '{print $1}' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
            value=$(echo "$line" | cut -d' ' -f2- | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')

            # Detect value type
            if echo "$value" | grep -Eq '^(true|false)$'; then
                vtype="bool"
            elif echo "$value" | grep -Eq '^-?[0-9]+$'; then
                vtype="int"
            else
                vtype="string"
            fi

            xfconf-query -c "$channel" -p "$prop" -t "$vtype" -s "$value" -n
        done < "$config_file"
    else
        echo "Config file '$config_file' does not exist."
    fi
done
